{{- range $path, $_ :=  .Files.Glob  "files/dashboards/**.json" }}
{{- $d := splitList "/" (dir $path) }}

{{- $folderTitle := index $d (sub (len $d) 1) }}
{{- $folder := $folderTitle | lower }}

{{- $dashboard := trimSuffix (ext $path) (base $path) }}
---
apiVersion: grafana.integreatly.org/v1beta1
kind: GrafanaDashboard
metadata:
  name: {{ $dashboard }}
spec:
  folderRef: {{ $folder }}
  resyncPeriod: 60s
  instanceSelector:
    matchLabels:
      grafana-instance: "default"
  json: >
    {{- $.Files.Get $path | nindent 4 }}
{{- end }}
